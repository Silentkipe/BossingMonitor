<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Necro Boss Monitor</title>
<link href="https://fonts.googleapis.com/css2?family=Share+Tech+Mono&family=Barlow+Condensed:wght@400;600;700;800&display=swap" rel="stylesheet">
<style>
:root {
  --bg:      #0e0f14;
  --panel:   #13151d;
  --panel2:  #181b26;
  --border:  #222638;
  --border2: #2b3050;
  --text:    #c4cce0;
  --dim:     #4e5670;
  --dim2:    #333a55;
  --alert:   #c01828;
  --alertbg: rgba(192,24,40,.16);
  --alertbd: rgba(192,24,40,.5);
  --ok:      #28a060;
  --blue:    #3888e0;
  --gold:    #c09828;
  --gold2:   #f0c040;
  --purple:  #7840c8;
  --mono:    'Share Tech Mono', monospace;
  --sans:    'Barlow Condensed', sans-serif;
}
*{box-sizing:border-box;margin:0;padding:0;}
html,body{width:320px;overflow:hidden;}
body{background:var(--bg);color:var(--text);font-family:var(--sans);font-size:14px;user-select:none;}

/* NOT ALT1 BANNER */
#not-alt1-banner{display:none;background:rgba(192,24,40,.15);border-bottom:1px solid var(--alertbd);padding:5px 10px;font-family:var(--mono);font-size:9px;color:#ff6060;letter-spacing:1px;text-align:center;}

/* TABS */
.tabs{display:flex;background:#090a0f;border-bottom:1px solid var(--border);}
.tab{flex:1;padding:7px 2px;text-align:center;font-size:11px;font-weight:700;letter-spacing:.8px;color:var(--dim);cursor:pointer;border-right:1px solid var(--border);transition:all .15s;text-transform:uppercase;}
.tab:last-child{border-right:none;}
.tab:hover{color:var(--text);background:var(--panel);}
.tab.active{color:var(--gold2);background:var(--panel);border-bottom:2px solid var(--gold);padding-bottom:5px;}

/* TOOLBAR */
.toolbar{display:flex;align-items:center;gap:8px;padding:6px 10px;background:var(--panel);border-bottom:1px solid var(--border);}
.preset-sel{flex:1;background:var(--panel2);border:1px solid var(--border2);color:var(--text);font-family:var(--sans);font-size:12px;font-weight:600;padding:4px 26px 4px 8px;border-radius:3px;cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='8' height='5'%3E%3Cpath d='M0 0l4 5 4-5z' fill='%234e5670'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 7px center;}
.preset-sel:focus{outline:none;border-color:var(--gold);}
.master-row{display:flex;align-items:center;gap:5px;flex-shrink:0;}
.master-lbl{font-size:11px;font-weight:800;letter-spacing:1px;color:var(--dim);}

/* SWITCH */
.sw{position:relative;display:inline-block;width:36px;height:20px;cursor:pointer;flex-shrink:0;}
.sw input{opacity:0;width:0;height:0;}
.sw-track{position:absolute;inset:0;background:var(--dim2);border-radius:10px;transition:background .2s;}
.sw input:checked~.sw-track{background:var(--blue);}
.sw-thumb{position:absolute;top:2px;left:2px;width:16px;height:16px;background:#fff;border-radius:50%;transition:transform .2s;box-shadow:0 1px 4px rgba(0,0,0,.5);}
.sw input:checked~.sw-thumb{transform:translateX(16px);}
.master-sw .sw input:checked~.sw-track{background:var(--ok);}

/* PAGES */
.page{display:none;}
.page.active{display:block;}

/* STACK BAR */
.stack-bar{display:flex;align-items:center;gap:10px;padding:5px 10px;background:#090a0f;border-bottom:1px solid var(--border);}
.stack-grp{display:flex;align-items:center;gap:5px;flex:1;}
.stack-lbl{font-family:var(--mono);font-size:9px;color:var(--dim);letter-spacing:1px;flex-shrink:0;width:38px;}
.sdots{display:flex;gap:2px;}
.sdot{width:12px;height:12px;border-radius:2px;border:1px solid var(--border2);background:#0a0b10;transition:all .15s;}
.sdot.on.necro{background:var(--purple);border-color:#a060f0;box-shadow:0 0 4px rgba(120,64,200,.7);}
.sdot.on.soul{background:#28b080;border-color:#40e8a0;box-shadow:0 0 4px rgba(40,176,128,.7);}
.sdot.pulse{animation:dpulse .45s ease-in-out infinite alternate;}
@keyframes dpulse{from{opacity:1;}to{opacity:.3;}}
.stack-num{font-family:var(--mono);font-size:10px;color:var(--dim);flex-shrink:0;}

/* BUFF GRID */
.buff-grid{display:grid;grid-template-columns:1fr 1fr;border-left:1px solid var(--border);border-top:1px solid var(--border);}
.buff-hdr{grid-column:1/-1;padding:4px 10px;background:#090a0f;border-right:1px solid var(--border);border-bottom:1px solid var(--border);font-family:var(--mono);font-size:9px;color:var(--dim2);letter-spacing:2px;text-transform:uppercase;}
.buff-cell{display:flex;align-items:center;gap:8px;padding:7px 10px;border-right:1px solid var(--border);border-bottom:1px solid var(--border);cursor:pointer;background:var(--panel);position:relative;overflow:hidden;transition:background .1s;}
.buff-cell:hover{background:var(--panel2);}
.buff-cell.on .buff-name{color:var(--text);}
.buff-cell.triggered{background:var(--alertbg);border-right-color:var(--alertbd);border-bottom-color:var(--alertbd);}
.buff-cell.triggered::before{content:'';position:absolute;left:0;top:0;bottom:0;width:3px;background:var(--alert);}
.buff-cell.triggered .buff-name{color:#fff;}
.buff-name{flex:1;font-size:13px;font-weight:700;letter-spacing:.3px;color:var(--dim);transition:color .15s;}

/* PRESETS */
.presets-page{padding:10px;}
.ptoolbar{display:flex;gap:6px;margin-bottom:8px;}
.p-sel{flex:1;background:var(--panel2);border:1px solid var(--border2);color:var(--text);font-family:var(--sans);font-size:12px;font-weight:600;padding:5px 8px;border-radius:3px;cursor:pointer;}
.p-sel:focus{outline:none;border-color:var(--gold);}
.pb{padding:5px 10px;border:none;border-radius:3px;font-family:var(--sans);font-size:12px;font-weight:700;cursor:pointer;letter-spacing:.5px;transition:opacity .15s;flex-shrink:0;}
.pb:hover{opacity:.82;}
.pb.blue{background:var(--blue);color:#fff;}
.pb.grey{background:var(--panel2);color:var(--text);border:1px solid var(--border2);}
.pb.red{background:var(--alert);color:#fff;}
.pb.green{background:var(--ok);color:#fff;}
.pname-row{display:flex;gap:6px;margin-bottom:10px;}
.pname-inp{flex:1;background:var(--panel2);border:1px solid var(--border2);color:var(--text);font-family:var(--sans);font-size:13px;font-weight:600;padding:5px 10px;border-radius:3px;}
.pname-inp::placeholder{color:var(--dim);}
.pname-inp:focus{outline:none;border-color:var(--gold);}
.pcheck-grid{display:grid;grid-template-columns:1fr 1fr;gap:1px;}
.pck{display:flex;align-items:center;gap:6px;padding:4px 6px;cursor:pointer;border-radius:2px;transition:background .1s;}
.pck:hover{background:var(--panel2);}
.pck input[type=checkbox]{width:13px;height:13px;accent-color:var(--blue);cursor:pointer;flex-shrink:0;}
.pck-lbl{font-size:12px;font-weight:600;color:var(--dim);cursor:pointer;}
.pck:has(input:checked) .pck-lbl{color:var(--text);}
.psec{grid-column:1/-1;font-family:var(--mono);font-size:9px;color:var(--dim2);letter-spacing:2px;padding:6px 6px 2px;}

/* SETTINGS */
.settings-page{padding:10px;max-height:400px;overflow-y:auto;}
.sgrp{font-family:var(--mono);font-size:9px;color:var(--dim2);letter-spacing:2px;text-transform:uppercase;padding:8px 0 4px;border-top:1px solid var(--border);margin-top:4px;}
.sgrp:first-child{border-top:none;margin-top:0;padding-top:0;}
.srow{display:flex;align-items:center;gap:10px;padding:5px 0;border-bottom:1px solid rgba(34,38,56,.5);}
.srow:last-child{border-bottom:none;}
.slbl{font-size:12px;font-weight:700;color:var(--text);flex:1;min-width:0;}
.ssub{font-size:10px;color:var(--dim);margin-top:1px;}
.sval{font-family:var(--mono);font-size:12px;color:var(--gold2);min-width:40px;text-align:right;flex-shrink:0;}
.slider{flex:1;-webkit-appearance:none;appearance:none;height:4px;background:var(--border2);border-radius:2px;outline:none;cursor:pointer;min-width:0;}
.slider::-webkit-slider-thumb{-webkit-appearance:none;width:14px;height:14px;border-radius:50%;background:var(--blue);cursor:pointer;box-shadow:0 0 5px rgba(56,136,224,.4);}
.slider::-moz-range-thumb{width:14px;height:14px;border:none;border-radius:50%;background:var(--blue);cursor:pointer;}
.stoggle-grid{display:grid;grid-template-columns:1fr 1fr;gap:6px;padding:6px 0;}
.stoggle{display:flex;align-items:center;justify-content:space-between;background:var(--panel2);border:1px solid var(--border);border-radius:3px;padding:5px 8px;}
.stoggle-lbl{font-size:12px;font-weight:700;}

/* ALERT CORNER */
#ao{position:fixed;bottom:26px;right:4px;background:rgba(8,9,14,.95);border:1px solid var(--alertbd);border-radius:3px;padding:5px 8px;min-width:120px;display:none;z-index:40;}
#ao.show{display:block;}
.ao-hdr{font-family:var(--mono);font-size:8px;color:var(--alert);letter-spacing:2px;padding-bottom:3px;border-bottom:1px solid rgba(192,24,40,.25);margin-bottom:3px;}
.ao-item{font-size:11px;font-weight:700;color:#fff;padding:1px 0;}

/* FINGER / VOLLEY OVERLAY */
#act-overlay{position:fixed;inset:0;display:flex;align-items:center;justify-content:center;pointer-events:none;opacity:0;z-index:100;transition:opacity .1s;}
#act-overlay.show{opacity:1;}
.act-txt{font-family:var(--mono);font-size:38px;letter-spacing:8px;text-transform:uppercase;animation:actpulse .5s ease-in-out infinite alternate;}
.act-txt.finger{color:#d060ff;text-shadow:0 0 18px #c040ff,0 0 40px #c040ff;}
.act-txt.volley{color:#40d8ff;text-shadow:0 0 18px #40c0ff,0 0 40px #40c0ff;}
@keyframes actpulse{from{transform:scale(1);}to{transform:scale(1.07);}}

/* FLASH */
#flash{position:fixed;inset:0;pointer-events:none;opacity:0;border:2px solid var(--alert);z-index:90;transition:opacity .08s;}

/* FOOTER */
.footer{display:flex;align-items:center;justify-content:space-between;padding:4px 10px;background:#090a0f;border-top:1px solid var(--border);}
.fstatus{font-family:var(--mono);font-size:9px;color:var(--dim);letter-spacing:1px;}
.fright{display:flex;align-items:center;gap:8px;}
.rdot{width:6px;height:6px;border-radius:50%;background:var(--dim2);transition:background .1s;}
.rdot.tick{background:var(--ok);}
.sndbtn{font-size:13px;cursor:pointer;color:var(--dim);transition:color .1s;}
.sndbtn.on{color:var(--text);}
</style>
</head>
<body>

<div id="flash"></div>
<div id="act-overlay"><div class="act-txt" id="act-txt">FINGER</div></div>
<div id="not-alt1-banner">âš  NOT RUNNING IN ALT1 â€” OPEN VIA ALT1 TOOLKIT</div>

<!-- TABS -->
<div class="tabs">
  <div class="tab active" onclick="goTab('buffs')">Buffs</div>
  <div class="tab" onclick="goTab('presets')">Presets</div>
  <div class="tab" onclick="goTab('settings')">Settings</div>
</div>

<!-- TOOLBAR -->
<div class="toolbar">
  <div class="master-row master-sw">
    <span class="master-lbl" id="master-lbl">ON</span>
    <label class="sw">
      <input type="checkbox" id="master-chk" checked onchange="onMaster(this)">
      <div class="sw-track"></div><div class="sw-thumb"></div>
    </label>
  </div>
  <select class="preset-sel" id="toolbar-preset" onchange="loadPreset(this.value)">
    <option value="">â€” Load Preset â€”</option>
  </select>
</div>

<!-- STACK BAR -->
<div class="stack-bar">
  <div class="stack-grp">
    <span class="stack-lbl">NECRO</span>
    <div class="sdots" id="necro-dots"></div>
    <span class="stack-num" id="necro-num">0/12</span>
  </div>
  <div class="stack-grp">
    <span class="stack-lbl">SOULS</span>
    <div class="sdots" id="soul-dots"></div>
    <span class="stack-num" id="soul-num">0/5</span>
  </div>
</div>

<!-- â•â• BUFFS TAB â•â• -->
<div class="page active" id="page-buffs">
<div class="buff-grid">
  <div class="buff-hdr">â”€â”€ Vitals â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
  <div class="buff-cell" id="bc-lowhp"      onclick="cellClick('lowhp')">    <label class="sw"><input type="checkbox" id="en-lowhp" checked onchange="cellSync('lowhp',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Low Health</span></div>
  <div class="buff-cell" id="bc-lowpray"    onclick="cellClick('lowpray')">  <label class="sw"><input type="checkbox" id="en-lowpray" checked onchange="cellSync('lowpray',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Low Prayer</span></div>

  <div class="buff-hdr">â”€â”€ Potions â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
  <div class="buff-cell" id="bc-ovl"        onclick="cellClick('ovl')">      <label class="sw"><input type="checkbox" id="en-ovl" checked onchange="cellSync('ovl',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Overload</span></div>
  <div class="buff-cell" id="bc-prayrenew"  onclick="cellClick('prayrenew')"><label class="sw"><input type="checkbox" id="en-prayrenew" checked onchange="cellSync('prayrenew',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Prayer Renewal</span></div>
  <div class="buff-cell" id="bc-weapon"     onclick="cellClick('weapon')">   <label class="sw"><input type="checkbox" id="en-weapon" onchange="cellSync('weapon',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Weapon Poison</span></div>
  <div class="buff-cell" id="bc-antifire"   onclick="cellClick('antifire')"> <label class="sw"><input type="checkbox" id="en-antifire" onchange="cellSync('antifire',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Antifire</span></div>
  <div class="buff-cell" id="bc-excal"      onclick="cellClick('excal')">    <label class="sw"><input type="checkbox" id="en-excal" onchange="cellSync('excal',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Excalibur</span></div>
  <div class="buff-cell" id="bc-sumrenew"   onclick="cellClick('sumrenew')"> <label class="sw"><input type="checkbox" id="en-sumrenew" onchange="cellSync('sumrenew',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Summon Renew</span></div>

  <div class="buff-hdr">â”€â”€ Necromancy â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
  <div class="buff-cell" id="bc-darkness"    onclick="cellClick('darkness')">   <label class="sw"><input type="checkbox" id="en-darkness" checked onchange="cellSync('darkness',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Darkness</span></div>
  <div class="buff-cell" id="bc-quickpray"   onclick="cellClick('quickpray')">  <label class="sw"><input type="checkbox" id="en-quickpray" checked onchange="cellSync('quickpray',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Quick Prayer</span></div>
  <div class="buff-cell" id="bc-animdead"    onclick="cellClick('animdead')">   <label class="sw"><input type="checkbox" id="en-animdead" onchange="cellSync('animdead',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Animate Dead</span></div>
  <div class="buff-cell" id="bc-souldrain"   onclick="cellClick('souldrain')">  <label class="sw"><input type="checkbox" id="en-souldrain" onchange="cellSync('souldrain',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Soul Drain</span></div>
  <div class="buff-cell" id="bc-riteshard"   onclick="cellClick('riteshard')">  <label class="sw"><input type="checkbox" id="en-riteshard" onchange="cellSync('riteshard',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Ritual Shard</span></div>
  <div class="buff-cell" id="bc-livingdeath" onclick="cellClick('livingdeath')"><label class="sw"><input type="checkbox" id="en-livingdeath" onchange="cellSync('livingdeath',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Living Death</span></div>

  <div class="buff-hdr">â”€â”€ Misc â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€</div>
  <div class="buff-cell" id="bc-aura"       onclick="cellClick('aura')">      <label class="sw"><input type="checkbox" id="en-aura" checked onchange="cellSync('aura',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Aura</span></div>
  <div class="buff-cell" id="bc-book"       onclick="cellClick('book')">      <label class="sw"><input type="checkbox" id="en-book" checked onchange="cellSync('book',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Scripture / Book</span></div>
  <div class="buff-cell" id="bc-familiar"   onclick="cellClick('familiar')">  <label class="sw"><input type="checkbox" id="en-familiar" onchange="cellSync('familiar',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Low Familiar</span></div>
  <div class="buff-cell" id="bc-vuln"       onclick="cellClick('vuln')">      <label class="sw"><input type="checkbox" id="en-vuln" onchange="cellSync('vuln',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Vulnerability</span></div>
  <div class="buff-cell" id="bc-aggro"      onclick="cellClick('aggro')">     <label class="sw"><input type="checkbox" id="en-aggro" onchange="cellSync('aggro',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Aggression</span></div>
  <div class="buff-cell" id="bc-smokecloud" onclick="cellClick('smokecloud')"><label class="sw"><input type="checkbox" id="en-smokecloud" onchange="cellSync('smokecloud',this)"><div class="sw-track"></div><div class="sw-thumb"></div></label><span class="buff-name">Smoke Cloud</span></div>
</div>
</div>

<!-- â•â• PRESETS TAB â•â• -->
<div class="page" id="page-presets">
<div class="presets-page">
  <div class="ptoolbar">
    <select class="p-sel" id="preset-list" onchange="onPresetSelect(this.value)">
      <option value="">â€” Create New â€”</option>
    </select>
    <button class="pb blue" onclick="exportPreset()">Export</button>
    <button class="pb grey" onclick="importPreset()">Import</button>
  </div>
  <div class="pname-row">
    <input class="pname-inp" id="preset-name" type="text" placeholder="Preset Name" maxlength="30">
    <button class="pb green" onclick="savePreset()">Save</button>
    <button class="pb red" onclick="deletePreset()">Delete</button>
  </div>
  <div class="pcheck-grid">
    <div class="psec">â”€â”€ Vitals</div><div></div>
    <div class="pck"><input type="checkbox" id="pc-lowhp"><label class="pck-lbl" for="pc-lowhp">Low Health</label></div>
    <div class="pck"><input type="checkbox" id="pc-lowpray"><label class="pck-lbl" for="pc-lowpray">Low Prayer</label></div>

    <div class="psec">â”€â”€ Potions</div><div></div>
    <div class="pck"><input type="checkbox" id="pc-ovl"><label class="pck-lbl" for="pc-ovl">Overload</label></div>
    <div class="pck"><input type="checkbox" id="pc-prayrenew"><label class="pck-lbl" for="pc-prayrenew">Prayer Renewal</label></div>
    <div class="pck"><input type="checkbox" id="pc-weapon"><label class="pck-lbl" for="pc-weapon">Weapon Poison</label></div>
    <div class="pck"><input type="checkbox" id="pc-antifire"><label class="pck-lbl" for="pc-antifire">Antifire</label></div>
    <div class="pck"><input type="checkbox" id="pc-excal"><label class="pck-lbl" for="pc-excal">Excalibur</label></div>
    <div class="pck"><input type="checkbox" id="pc-sumrenew"><label class="pck-lbl" for="pc-sumrenew">Summon Renew</label></div>

    <div class="psec">â”€â”€ Necromancy</div><div></div>
    <div class="pck"><input type="checkbox" id="pc-darkness"><label class="pck-lbl" for="pc-darkness">Darkness</label></div>
    <div class="pck"><input type="checkbox" id="pc-quickpray"><label class="pck-lbl" for="pc-quickpray">Quick Prayer</label></div>
    <div class="pck"><input type="checkbox" id="pc-animdead"><label class="pck-lbl" for="pc-animdead">Animate Dead</label></div>
    <div class="pck"><input type="checkbox" id="pc-souldrain"><label class="pck-lbl" for="pc-souldrain">Soul Drain</label></div>
    <div class="pck"><input type="checkbox" id="pc-riteshard"><label class="pck-lbl" for="pc-riteshard">Ritual Shard</label></div>
    <div class="pck"><input type="checkbox" id="pc-livingdeath"><label class="pck-lbl" for="pc-livingdeath">Living Death</label></div>

    <div class="psec">â”€â”€ Misc</div><div></div>
    <div class="pck"><input type="checkbox" id="pc-aura"><label class="pck-lbl" for="pc-aura">Aura</label></div>
    <div class="pck"><input type="checkbox" id="pc-book"><label class="pck-lbl" for="pc-book">Scripture / Book</label></div>
    <div class="pck"><input type="checkbox" id="pc-familiar"><label class="pck-lbl" for="pc-familiar">Low Familiar</label></div>
    <div class="pck"><input type="checkbox" id="pc-vuln"><label class="pck-lbl" for="pc-vuln">Vulnerability</label></div>
    <div class="pck"><input type="checkbox" id="pc-aggro"><label class="pck-lbl" for="pc-aggro">Aggression</label></div>
    <div class="pck"><input type="checkbox" id="pc-smokecloud"><label class="pck-lbl" for="pc-smokecloud">Smoke Cloud</label></div>
  </div>
</div>
</div>

<!-- â•â• SETTINGS TAB â•â• -->
<div class="page" id="page-settings">
<div class="settings-page">
  <div class="sgrp">Thresholds</div>
  <div class="srow">
    <div class="slbl">HP Warning<div class="ssub">Alert when HP % drops below</div></div>
    <input class="slider" id="sl-hp" type="range" min="10" max="80" value="50" oninput="slUpdate('hp',this.value)">
    <span class="sval" id="sv-hp">50%</span>
  </div>
  <div class="srow">
    <div class="slbl">Prayer Warning<div class="ssub">Alert when prayer % drops below</div></div>
    <input class="slider" id="sl-pray" type="range" min="10" max="70" value="30" oninput="slUpdate('pray',this.value)">
    <span class="sval" id="sv-pray">30%</span>
  </div>
  <div class="srow">
    <div class="slbl">Time Buffer<div class="ssub">Warn N sec before buff expires</div></div>
    <input class="slider" id="sl-buf" type="range" min="0" max="30" value="10" oninput="slUpdate('buf',this.value)">
    <span class="sval" id="sv-buf">10s</span>
  </div>

  <div class="sgrp">Performance</div>
  <div class="srow">
    <div class="slbl">Refresh Rate<div class="ssub">How often to scan screen (ms)</div></div>
    <input class="slider" id="sl-ref" type="range" min="200" max="1200" step="100" value="600" oninput="slUpdate('ref',this.value)">
    <span class="sval" id="sv-ref">600ms</span>
  </div>
  <div class="srow">
    <div class="slbl">Sound Volume</div>
    <input class="slider" id="sl-vol" type="range" min="0" max="100" value="40" oninput="slUpdate('vol',this.value)">
    <span class="sval" id="sv-vol">40%</span>
  </div>
  <div class="srow">
    <div class="slbl">Overlay Duration<div class="ssub">How long FINGER/VOLLEY shows</div></div>
    <input class="slider" id="sl-odur" type="range" min="1" max="5" value="2" oninput="slUpdate('odur',this.value)">
    <span class="sval" id="sv-odur">2s</span>
  </div>

  <div class="sgrp">Options</div>
  <div class="stoggle-grid">
    <div class="stoggle"><span class="stoggle-lbl">Sounds</span><label class="sw"><input type="checkbox" id="opt-sound" checked onchange="CFG.sound=this.checked;saveStorage()"><div class="sw-track"></div><div class="sw-thumb"></div></label></div>
    <div class="stoggle"><span class="stoggle-lbl">Flash Border</span><label class="sw"><input type="checkbox" id="opt-flash" checked onchange="CFG.flash=this.checked;saveStorage()"><div class="sw-track"></div><div class="sw-thumb"></div></label></div>
    <div class="stoggle"><span class="stoggle-lbl">Buff Colors</span><label class="sw"><input type="checkbox" id="opt-colors" checked onchange="CFG.colors=this.checked"><div class="sw-track"></div><div class="sw-thumb"></div></label></div>
    <div class="stoggle"><span class="stoggle-lbl">Debug Mode</span><label class="sw"><input type="checkbox" id="opt-debug" onchange="CFG.debug=this.checked"><div class="sw-track"></div><div class="sw-thumb"></div></label></div>
  </div>
</div>
</div>

<!-- ALERT CORNER OVERLAY -->
<div id="ao">
  <div class="ao-hdr">âš  ALERTS</div>
  <div id="ao-list"></div>
</div>

<!-- FOOTER -->
<div class="footer">
  <div class="fstatus" id="footer-status">LOADING...</div>
  <div class="fright">
    <div class="rdot" id="rdot"></div>
    <div class="sndbtn on" id="sndbtn" onclick="toggleSound()">ğŸ”Š</div>
  </div>
</div>

<script>
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  GLOBAL CONFIG & STATE (read by app.js too)
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.CFG = {
  hpWarnPct:  50,
  prayWarnPct: 30,
  timeBuf:    10,
  refreshMs:  600,
  volume:     0.40,
  overlayDur: 2,
  sound:      true,
  flash:      true,
  colors:     true,
  debug:      false,
};

window.APP_STATE = {
  master:    true,
  necrosis:  0,
  souls:     0,
  hpPct:     100,
  prayerPct: 100,
  triggered: new Set(),
  presets:   {},
};

const BNAMES = {
  lowhp:'Low Health', lowpray:'Low Prayer', ovl:'Overload', prayrenew:'Prayer Renewal',
  weapon:'Weapon Poison', antifire:'Antifire', excal:'Excalibur', sumrenew:'Summon Renew',
  darkness:'Darkness', quickpray:'Quick Prayer', animdead:'Animate Dead',
  souldrain:'Soul Drain', riteshard:'Ritual Shard', livingdeath:'Living Death',
  aura:'Aura', book:'Scripture / Book', familiar:'Low Familiar',
  vuln:'Vulnerability', aggro:'Aggression', smokecloud:'Smoke Cloud',
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  AUDIO
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _ac;
const getAc = () => _ac || (_ac = new (window.AudioContext || window.webkitAudioContext)());
function beep(f, d, v, t = 'sine') {
  if (!CFG.sound) return;
  v = (v ?? 0.2) * CFG.volume;
  try {
    const c = getAc(), o = c.createOscillator(), g = c.createGain();
    o.connect(g); g.connect(c.destination);
    o.type = t; o.frequency.value = f;
    g.gain.setValueAtTime(v, c.currentTime);
    g.gain.exponentialRampToValueAtTime(0.001, c.currentTime + d);
    o.start(); o.stop(c.currentTime + d);
  } catch(e) {}
}
window.playSound = function(type) {
  if (!CFG.sound) return;
  if (type === 'warning') { beep(660, .18, .4); }
  if (type === 'danger')  { beep(440, .12, .5); setTimeout(() => beep(330, .3, .5), 160); }
  if (type === 'finger')  { beep(180, .08, .6, 'sawtooth'); setTimeout(() => beep(240, .08, .5, 'sawtooth'), 90); setTimeout(() => beep(180, .4, .5), 180); }
  if (type === 'volley')  { beep(880, .1, .4); setTimeout(() => beep(1100, .1, .4), 110); setTimeout(() => beep(1320, .25, .4), 220); }
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  FLASH
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _ft;
window.flashBorder = function(color) {
  if (!CFG.flash) return;
  const el = document.getElementById('flash');
  el.style.borderColor = color || '#c01828';
  el.style.opacity = '1';
  clearTimeout(_ft);
  _ft = setTimeout(() => el.style.opacity = '0', 350);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ACTION OVERLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
let _ot;
window.showAction = function(word, cls) {
  const ov = document.getElementById('act-overlay');
  const tx = document.getElementById('act-txt');
  tx.textContent = word;
  tx.className = 'act-txt ' + cls;
  ov.classList.add('show');
  clearTimeout(_ot);
  _ot = setTimeout(() => ov.classList.remove('show'), CFG.overlayDur * 1000);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  REFRESH DOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.tickDot = function() {
  const d = document.getElementById('rdot');
  d.classList.add('tick');
  setTimeout(() => d.classList.remove('tick'), 150);
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  TABS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function goTab(id) {
  document.querySelectorAll('.tab').forEach((t, i) => t.classList.toggle('active', ['buffs','presets','settings'][i] === id));
  document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
  document.getElementById('page-' + id).classList.add('active');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BUFF CELLS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function cellClick(id) {
  const chk = document.getElementById('en-' + id);
  chk.checked = !chk.checked;
  cellSync(id, chk);
}
function cellSync(id, chk) {
  document.getElementById('bc-' + id).classList.toggle('on', chk.checked);
  if (!chk.checked) { document.getElementById('bc-' + id).classList.remove('triggered'); APP_STATE.triggered.delete(id); updateOverlay(); }
}
window.isEnabled = function(id) { return document.getElementById('en-' + id)?.checked ?? false; };

window.setTriggered = function(id, on) {
  if (!APP_STATE.master) return;
  const cell = document.getElementById('bc-' + id);
  if (!isEnabled(id)) { cell?.classList.remove('triggered'); APP_STATE.triggered.delete(id); updateOverlay(); return; }
  if (on) { cell?.classList.add('triggered'); APP_STATE.triggered.add(id); }
  else    { cell?.classList.remove('triggered'); APP_STATE.triggered.delete(id); }
  updateOverlay();
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  ALERT CORNER
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function updateOverlay() {
  const list = document.getElementById('ao-list');
  const ov   = document.getElementById('ao');
  const items = [...APP_STATE.triggered];
  list.innerHTML = items.map(id => `<div class="ao-item">Â» ${BNAMES[id] || id}</div>`).join('');
  ov.classList.toggle('show', items.length > 0 && APP_STATE.master);
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STACKS DISPLAY
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
window.renderDots = function() {
  const nd = document.getElementById('necro-dots');
  const sd = document.getElementById('soul-dots');
  const nAlert = APP_STATE.necrosis >= 6;
  const sAlert = APP_STATE.souls >= 5;
  nd.innerHTML = '';
  sd.innerHTML = '';
  for (let i = 0; i < 12; i++) {
    const d = document.createElement('div');
    d.className = 'sdot' + (i < APP_STATE.necrosis ? ' on necro' + (nAlert ? ' pulse' : '') : '');
    nd.appendChild(d);
  }
  for (let i = 0; i < 5; i++) {
    const d = document.createElement('div');
    d.className = 'sdot' + (i < APP_STATE.souls ? ' on soul' + (sAlert ? ' pulse' : '') : '');
    sd.appendChild(d);
  }
  document.getElementById('necro-num').textContent = APP_STATE.necrosis + '/12';
  document.getElementById('soul-num').textContent  = APP_STATE.souls + '/5';
};

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  MASTER TOGGLE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function onMaster(chk) {
  APP_STATE.master = chk.checked;
  document.getElementById('master-lbl').textContent = chk.checked ? 'ON' : 'OFF';
  if (!chk.checked) document.getElementById('ao').classList.remove('show');
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  SETTINGS SLIDERS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function slUpdate(key, val) {
  val = parseFloat(val);
  const map = {
    hp:   () => { CFG.hpWarnPct   = val; document.getElementById('sv-hp').textContent   = val + '%'; },
    pray: () => { CFG.prayWarnPct = val; document.getElementById('sv-pray').textContent = val + '%'; },
    buf:  () => { CFG.timeBuf     = val; document.getElementById('sv-buf').textContent  = val + 's'; },
    ref:  () => { CFG.refreshMs   = val; document.getElementById('sv-ref').textContent  = val + 'ms'; },
    vol:  () => { CFG.volume = val / 100; document.getElementById('sv-vol').textContent = val + '%'; },
    odur: () => { CFG.overlayDur  = val; document.getElementById('sv-odur').textContent = val + 's'; },
  };
  map[key]?.();
  saveStorage();
}
function toggleSound() {
  CFG.sound = !CFG.sound;
  document.getElementById('opt-sound').checked = CFG.sound;
  const btn = document.getElementById('sndbtn');
  btn.textContent = CFG.sound ? 'ğŸ”Š' : 'ğŸ”‡';
  btn.classList.toggle('on', CFG.sound);
  saveStorage();
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  PRESETS
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
const ALL_IDS = Object.keys(BNAMES);

function refreshDropdowns() {
  const names = Object.keys(APP_STATE.presets).sort();
  const opts = names.map(n => `<option value="${n}">${n}</option>`).join('');
  document.getElementById('toolbar-preset').innerHTML = '<option value="">â€” Load Preset â€”</option>' + opts;
  document.getElementById('preset-list').innerHTML    = '<option value="">â€” Create New â€”</option>' + opts;
}

function onPresetSelect(name) {
  if (!name) { document.getElementById('preset-name').value = ''; return; }
  document.getElementById('preset-name').value = name;
  // Sync checkboxes in presets tab
  const enabled = APP_STATE.presets[name]?.enabled || [];
  ALL_IDS.forEach(id => { const pc = document.getElementById('pc-' + id); if (pc) pc.checked = enabled.includes(id); });
}

function savePreset() {
  const name = document.getElementById('preset-name').value.trim();
  if (!name) { alert('Enter a preset name first.'); return; }
  const enabled = ALL_IDS.filter(id => document.getElementById('pc-' + id)?.checked);
  APP_STATE.presets[name] = { enabled };
  refreshDropdowns();
  saveStorage();
  document.getElementById('preset-list').value = name;
  document.getElementById('toolbar-preset').value = '';
}

function deletePreset() {
  const name = document.getElementById('preset-list').value;
  if (!name) { alert('Select a preset to delete.'); return; }
  if (!confirm('Delete "' + name + '"?')) return;
  delete APP_STATE.presets[name];
  refreshDropdowns();
  saveStorage();
  document.getElementById('preset-name').value = '';
}

function loadPreset(name) {
  if (!name || !APP_STATE.presets[name]) return;
  const enabled = APP_STATE.presets[name].enabled || [];
  ALL_IDS.forEach(id => {
    const chk = document.getElementById('en-' + id);
    const pc  = document.getElementById('pc-' + id);
    if (chk) { chk.checked = enabled.includes(id); cellSync(id, chk); }
    if (pc)  pc.checked = enabled.includes(id);
  });
  document.getElementById('preset-name').value = name;
  document.getElementById('preset-list').value = name;
}

function exportPreset() {
  const name = document.getElementById('preset-list').value;
  const data = name && APP_STATE.presets[name] ? { name, ...APP_STATE.presets[name] } : APP_STATE.presets;
  const json = JSON.stringify(data, null, 2);
  navigator.clipboard?.writeText(json).then(() => alert('Copied to clipboard!')).catch(() => prompt('Copy this:', json));
}

function importPreset() {
  const json = prompt('Paste exported preset JSON:');
  if (!json) return;
  try {
    const d = JSON.parse(json);
    if (d.name && d.enabled) APP_STATE.presets[d.name] = { enabled: d.enabled };
    else Object.assign(APP_STATE.presets, d);
    refreshDropdowns(); saveStorage(); alert('Imported!');
  } catch(e) { alert('Invalid JSON â€” check it and try again.'); }
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  STORAGE
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
function saveStorage() {
  try {
    localStorage.setItem('necro-monitor-v2', JSON.stringify({
      presets: APP_STATE.presets,
      cfg: { hpWarnPct: CFG.hpWarnPct, prayWarnPct: CFG.prayWarnPct, timeBuf: CFG.timeBuf,
             refreshMs: CFG.refreshMs, volume: CFG.volume, overlayDur: CFG.overlayDur,
             sound: CFG.sound, flash: CFG.flash },
    }));
  } catch(e) {}
}

function loadStorage() {
  try {
    const raw = localStorage.getItem('necro-monitor-v2');
    if (!raw) return;
    const d = JSON.parse(raw);
    if (d.presets) APP_STATE.presets = d.presets;
    if (d.cfg) {
      Object.assign(CFG, d.cfg);
      // Sync UI
      const sv = (id, val, txt) => { const s = document.getElementById('sl-'+id); const v = document.getElementById('sv-'+id); if(s) s.value = val; if(v) v.textContent = txt; };
      sv('hp',   CFG.hpWarnPct,                CFG.hpWarnPct + '%');
      sv('pray', CFG.prayWarnPct,              CFG.prayWarnPct + '%');
      sv('buf',  CFG.timeBuf,                  CFG.timeBuf + 's');
      sv('ref',  CFG.refreshMs,                CFG.refreshMs + 'ms');
      sv('vol',  Math.round(CFG.volume * 100), Math.round(CFG.volume * 100) + '%');
      sv('odur', CFG.overlayDur,               CFG.overlayDur + 's');
      document.getElementById('opt-sound').checked = CFG.sound;
      document.getElementById('opt-flash').checked = CFG.flash;
      if (!CFG.sound) { document.getElementById('sndbtn').textContent = 'ğŸ”‡'; document.getElementById('sndbtn').classList.remove('on'); }
    }
  } catch(e) {}
}

// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
//  BOOT
// â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
loadStorage();
refreshDropdowns();
renderDots();
</script>

<!-- Alt1 API + our screen reader -->
<script src="./index.bundle.js"></script>
<script src="./app.js"></script>
</body>
</html>
